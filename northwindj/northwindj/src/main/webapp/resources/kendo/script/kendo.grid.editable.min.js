function intColumn(n){var t=n.min||0,i=n.max||10;return $.extend(!0,{width:200,format:"{0:n0}",editor:function(n,r){$('<input name="'+r.field+'" data-bind="value:'+r.field+'"/>').appendTo(n).kendoNumericTextBox({format:"{0:n0}",min:t,max:i})}},n)}function floatColumn(n){return $.extend(!0,{width:200,format:"{0:0.00}",editor:function(n,t){$('<input name="'+t.field+'" data-bind="value:'+t.field+'"/>').appendTo(n).kendoNumericTextBox({decimals:2,spinners:!1})}},n)}function doubleColumn(n){var t=n.min||null,i=n.max||null;return $.extend(!0,{width:200,format:"{0:n6}",editor:function(n,r){$('<input name="'+r.field+'" data-bind="value:'+r.field+'"/>').appendTo(n).kendoNumericTextBox({decimals:6,format:"n6",min:t,max:i,spinners:!1})}},n)}function textareaEditor(n,t){$('<textarea name="'+t.field+'" data-bind="value:'+t.field+'" class="k-input k-textbox" rows="5" style="width: 100%"/>').appendTo(n)}function descriptionColumn(n){var t=n&&n.field||"Description";return $.extend(!0,{field:t,title:"描述",width:300,editor:textareaEditor,template:function(n){var i=n[t];return i?kendo.format("<pre class='k-content'>{0}<\/pre>",i):""}},n)}function dateColumn(n){return $.extend(!0,{format:"{0: yyyy-MM-dd}",width:200,editor:function(n,t){$('<input name="'+t.field+'" data-bind="value:'+t.field+'"/>').appendTo(n).kendoDatePicker({format:"yyyy-MM-dd",parseFormats:["yyyy-MM-dd"]})}},n)}function timeColumn(n){return $.extend(!0,{format:"{0: HH:mm}",width:200,editor:function(n,t){$('<input name="'+t.field+'" data-bind="value:'+t.field+'"/>').appendTo(n).kendoTimePicker({format:"HH:mm",parseFormats:["HH:mm"]})}},n)}function datetimeColumn(n){return $.extend(!0,{format:"{0: yyyy-MM-dd HH:mm}",width:200,editor:function(n,t){$('<input name="'+t.field+'" data-bind="value:'+t.field+'"/>').appendTo(n).kendoDateTimePicker({format:"yyyy-MM-dd HH:mm",parseFormats:["yyyy-MM-dd HH:mm"]})}},n)}(function(n,t){t(["./kendo.grid"],n)})(function(){return function(n,t){var i=window.kendo,u=i.ui,r=i.ui.Grid,l=n.extend,s=n.proxy,o="k-state-disabled",f=".kendoGrid",e="click",h=["kendoComboBox","kendoDatePicker","kendoDateTimePicker","kendoDropDownList","kendoMaskedTextBox","kendoNumericTextBox","kendoMultiSelect"],c;Date.prototype.getWeekOfYear=function(n){n=(n||0)-0;(isNaN(n)||n>6)&&(n=0);var t=this.getFullYear(),i=new Date(t,0,1),r=7-i.getDay()+n,u=(new Date(t,this.getMonth(),this.getDate())-i)/864e5+1;return Math.ceil((u-r)/7)+1};l(u,{enable:function(i,r){i.length&&(r=r===t?!0:r,i.data()&&n(h).each(function(){if(i.data()[this]){i.data()[this].enable(r);return}}),i.attr("disabled",!r))},readonly:function(i,r){i.length&&(r=r===t?!0:r,i.data()&&n(h).each(function(){if(i.data()[this]){i.data()[this].readonly(r);return}}),i.attr("readonly",r))}},!0);c=r.extend({init:function(t,i){var u=this;n(i.columns).each(function(){var t=this,f=t.foreign,e=i.filterable,r;f&&(r=f.mode||"key",r=="key"?n.extend(!0,t,u._createForeignKeyColumn(t)):r=="value"?n.extend(!0,t,u._createForeignValueColumn(t)):r=="collection"&&n.extend(!0,t,u._createForeignCollectionColumn(t)))});typeof i.toolbar=="undefined"&&(i.toolbar=["title","separator","create","edit","destroy","update","canceledit"]);i.name="Grid";r.fn.init.call(u,t,i)},options:{name:"EditableGrid",scrollable:!1,sortable:!0,filterable:!0,selectable:!0,pageable:{refresh:!0,pageSizes:!0},columnsDisabled:!1,columnsReadonly:!1,editable:"popup",dataBound:function(){this.enableToolbar(this.select().length>0)},change:function(){this.enableToolbar(this.select().length>0)},edit:function(t){var r=this,f=t.model,i=t.container,e=r.options.columnsDisabled,o=r.options.columnsReadonly;f.isNew()||n('[name="Id"]',i).attr("readonly",!0);n(r.options.columns).each(function(t,r){var s=r.field,c=n('label[for="'+s+'"]',i).parent(),h=c.next(".k-edit-field");c.attr("label-container-for",s);h.attr("data-container-for")||h.attr("data-container-for",s);(!f.editable||f.editable(s))&&s?e||r.disabled?u.enable(n('[name="'+s+'"]',i),!1):(o||r.readonly)&&u.readonly(n('[name="'+s+'"]',i)):h.addClass("k-display-field")})},save:function(t){var u=this,i=t.model,r=i.isNew();n(u.options.columns).each(function(n,u){var f=u.field,c,s;if(u.foreign){var f=this.field,e=u.foreign,o=e.mode||"key",h=e.dataValueField||"Id";o=="key"?(c=e.entity||f.replace("Id",""),r&&!i[f]&&(s=t.container.find("input[name="+f+"]").data("kendoDropDownList").dataItem(),i[f]=s&&s[h]||null)):o=="entity"?(r&&!i[f]&&(i[f]=t.container.find("input[name="+f+"]").data("kendoDropDownList").dataItem()),i[f+"Id"]=i[f]?i[f].Id:null):o=="collection"}})}},select:function(t){var r=this,i=r.selectable;if(t=n(t),t.length){i.options.multiple||(i.clear(),t=t.first());r._isLocked()&&(t=t.add(t.map(function(){return r._relatedRow(this)})));i.value(t);return}return typeof i!="undefined"?i.value():t},enableToolbar:function(n,t){var r=this,u=r.options.toolbar,t=t||".k-grid-edit,.k-grid-delete",i;u&&(i=r.wrapper.find(".k-grid-toolbar"),typeof n=="undefined"&&(n=!0),n?i.find(t).removeClass(o):i.find(t).addClass(o))},showToolbar:function(n,t){var r=this,u=r.options.toolbar,i;u&&(i=r.wrapper.find(".k-grid-toolbar"),typeof n=="undefined"&&(n=!0),n?i.find(t).show():i.find(t).hide())},_toolbar:function(){var t=this,h=t.options.toolbar,u=t.options.editable,i;if(r.fn._toolbar.call(t),h&&(i=t.wrapper.find(".k-grid-toolbar"),u&&u.create!==!1)){i.on(e+f,".k-grid-edit",function(){t.editRow(t.select())}).on(e+f,".k-grid-delete",function(i){n(i.target).hasClass(o)||t.removeRow(t.select())});i.find(".k-grid-update").hide();i.find(".k-grid-cancel").hide();this._editCancelClickHandler||(this._editCancelClickHandler=s(this._editCancelClick,this));i.on(e+f,"a.k-grid-cancel",this._editCancelClickHandler);this._editUpdateClickHandler||(this._editUpdateClickHandler=s(this._editUpdateClick,this));i.on(e+f,"a.k-grid-update",this._editUpdateClickHandler)}},_createButton:function(n){var t=this,i;return n=="title"?(i=t.options.title||"","<span class='k-title k-widget k-state-selected'>"+i+"<\/span>"):n=="separator"?"<span class='k-separator'><\/span>":r.fn._createButton.call(t,n)},_createInlineEditor:function(n,t){var u=this,f=u.options.toolbar,i;r.fn._createInlineEditor.call(u,n,t);f&&(i=u.wrapper.find(".k-grid-toolbar"),i.find(".k-grid-edit").hide(),i.find(".k-grid-delete").hide(),i.find(".k-grid-update").show(),i.find(".k-grid-cancel").show())},_destroyEditView:function(){var t=this,i=t.options.toolbar,n;r.fn._destroyEditView.call(t);i&&(n=t.wrapper.find(".k-grid-toolbar"),n.find(".k-grid-update").hide(),n.find(".k-grid-cancel").hide(),n.find(".k-grid-edit").show(),n.find(".k-grid-delete").show())},_createForeignKeyColumn:function(t){function o(t,i,u){return u=n.extend(!0,{field:i.field,entity:r.entity,dataTextField:r.dataTextField,dataValueField:r.dataValueField,template:r.template,url:r.url,expand:r.expand},u),t.kendoEditableDropDownList(u)}var f=t.field,r=t.foreign,s=t.editorInit,u=r.entity||f.replace("Id",""),c=r.required&&"required"||"",l=r.dataTextField||"Name",h=r.dataValueField||"Id",a=r.filterOperator||"startswith",e=r.filter||[];return typeof e=="function"&&(e=e(model)),n.extend(!0,{width:200,editor:function(r,l){var v=l.model,y=n('<input name="'+f+'" data-bind="value:'+f+'" '+c+"/>").appendTo(r),p=o(y,t,{filter:a,dataSource:{filter:e},dataBound:function(){var t=this,n;v.isNew()&&(u!=f&&(n=t.dataItem(),v[u]=n&&n[h]?n:null),t.trigger("change"))}}).data("kendoDropDownList");u!=f&&n.extend(!0,p,{_change:function(){var t=this,n=t.dataItem();v[u]=n&&n[h]?n:null;i.ui.DropDownList.fn._change.call(t)}});typeof s=="function"&&s(r,l)},template:u!=f?i.format("#=typeof({0}) != 'undefined' && {0} ? {0}.{1} : ''#",u,l):i.format("#=typeof({0}) != 'undefined' && {0} ? {0} : ''#",u),filterable:{ui:function(n){o(n,t,{dataSource:{filter:e}})},cell:{template:function(n){o(n.element,t,{dataSource:{filter:e}})},showOperators:!1}}},t)},_createForeignValueColumn:function(t){function e(t,i,u){return u=n.extend(!0,{field:i.field,entity:r.entity,dataTextField:r.dataTextField,dataValueField:r.dataValueField,template:r.template,url:r.url,expand:r.expand},u),t.kendoEditableComboBox(u)}var f=t.field,r=t.foreign,o=t.editorInit,u=r.entity||f.replace("Id",""),h=r.required&&"required"||"",c=r.dataTextField||"Name",s=r.dataValueField||"Id";return n.extend(!0,{width:200,editor:function(c,l){var a=l.model,p=n('<input name="'+f+'" data-bind="value:'+f+'" '+h+"/>").appendTo(c),w=r.filterOperator||"startswith",v=r.filter||[],y;typeof v=="function"&&(v=v(a));y=e(p,t,{filter:w,dataSource:{filter:v},dataBound:function(){var t=this,n;a.isNew()&&(u!=f&&(n=t.dataItem(),a[u]=n&&n[s]?n:null),t.trigger("change"))}}).data("kendoComboBox");u!=f&&n.extend(!0,y,{_change:function(){var t=this,n=t.dataItem();a[u]=n&&n[s]?n:null;i.ui.ComboBox.fn._change.call(t)}});typeof o=="function"&&o(c,l)},template:u!=f?i.format("#=typeof({0}) != 'undefined' && {0} ? {0}.{1} : ''#",u,c):i.format("#=typeof({0}) != 'undefined' && {0} ? {0} : ''#",u),filterable:{ui:function(n){e(n,t,{dataSource:{filter:filter}})},cell:{template:function(n){e(n.element,t,{dataSource:{filter:filter}})},showOperators:!1}}},t)},_createForeignCollectionColumn:function(t){function v(t){var r=t.parent().parent().data("kendoFilterCell"),f=r.viewModel;n.extend(!0,r,{_merge:function(t){var f=this,s=t.logic||"and",e=t.filters,r,h=f.dataSource.filter()||{filters:[],logic:"and"};return e.length&&(r=e[0],r.value.length?r.expression=n.map(r.value,function(n){return i.format("{0}/{1}({2}:{2}/{3} eq '{4}')",u,"any",c,o,n[o])}).join(" "+s+" "):t.filters=[]),i.ui.FilterCell.fn._merge.call(f,t)},_parse:function(n){return n||""}})}function s(t,u,f){var h=r.placeholder||i.format("选择{0}…",u.title),s=r.template||i.format("#={0} ? {1} : '<空>'#",o,e),l=r.valueTemplate||s,a=r.url||"/odata/"+c,v=r.expand||i.format("?$select={0},{1}",o,e);return f=n.extend(!0,{filter:"startswith",placeholder:h,dataTextField:e,dataValueField:o,dataSource:{type:"odata-v4",serverFiltering:!0,serverSorting:!0,transport:{read:a+v},sort:{field:e}},template:s,valueTemplate:l},f),t.kendoMultiSelect(f)}var u=t.field,l=t.templatePre||!1,r=t.foreign,h=t.editorInit,c=r.entity||u.replace(/(\s+)?.$/,""),e=r.dataTextField||"Name",o=r.dataValueField||"Id",a=r.filterOperator||"startswith",f=r.filter||[];return typeof f=="function"&&(f=f(model)),n.extend(!0,{width:200,editor:function(i,r){var o=r.model,e=n('<input name="'+u+'" data-bind="value:'+u+'"/>').appendTo(i);s(e,t,{autoClose:!1,filter:a,dataSource:{filter:f}});typeof h=="function"&&h(i,r)},template:function(t){var i=t[u]?n.map(t[u],function(n){return n[e]}).join(" | "):"";return l&&(i='<pre class="k-content list-wrapper">'+i+"<\/pre>"),i},filterable:{ui:function(n){s(n,t,{dataSource:{filter:f}})},cell:{operator:"any",template:function(n){v(n.element);s(n.element,t,{dataSource:{filter:f}})},showOperators:!1}}},t)}});u.plugin(c)}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});